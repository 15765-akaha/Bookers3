<div class="row">
  <div class="col-xs-3">
	<%= render 'users/info', user: @user %>
	<%= render 'books/new', book: @book_new %>
  </div>
  <div class="col-xs-9">
	<h2>Book detail</h2>
	<table class= "table table-striped">
	 <tr>
		<td><%= attachment_image_tag @user, :profile_image, :fill, 40, 40, format: 'jpeg', fallback: "no_image.jpg", :size => "40x40"%><br>
		<%= link_to @book.user.name, user_path(@book.user.id) %></td>
		<td><%= @book.title %></td>
		<td><%= @book.body %></td>
		<!-- いいね機能 -->
		<% if @book.favorited_by?(current_user) %>
		<td><%= link_to book_favorites_path(@book), method: :delete do %><i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
			<%= @book.favorites.count %> いいね
			<% end %></td>
		<% else %>
		<td><%= link_to book_favorites_path(@book), method: :post do %>
			<i class="fa fa-heart-o" aria-hidden="true"></i>
			<%= @book.favorites.count %> いいね
			<% end %>
		<% end %>
		<!-- いいね機能 -->

		<!-- コメント件数 -->
		<td>コメント数: <%= @book.book_comments.count %></td>
		<% if @user.id == current_user.id %>
		<td><%= link_to 'Edit', edit_book_path(@book),
			class: "btn btn-success" %></td>
		<td><%= link_to 'Destroy', book_path, method: :delete ,data: { confirm: 'Are you sure?' }, class: "btn btn-danger" %>
		</td>
		<% end %>
	 </tr>
	</table>
		<!-- コメント一覧 -->
	 <% @book.book_comments.each do |comment| %>
  <div class="row">
	<div class="col-xs-2 col-xs-offset-1">
	 <%= attachment_image_tag comment.user, :profile_image, :fill, 40, 40, format: 'jpeg', fallback: "no_image.jpg", :size => "40x40" %>
	 <%= comment.user.name %>
	 <%= comment.created_at.strftime('%Y/%m/%d') %>
    </div>
    <div class="col-xs-8">
  	<div class="panel-body well">
	 <%= comment.comment %><br>

	 <% if comment.user == current_user %>
	 <%= link_to 'コメントを削除する', book_book_comment_path(comment.book.id, comment.id), method: :delete, data:{ confirm: "本当に削除しますか？" }, class: "small" %>
	 <% end %>
    </div>
    </div>
  </div>
    <% end %>

    　<!-- コメント投稿フォーム -->
       <div class="col-xs-8 col-xs-offset-3">
         <% if flash[:danger] %>
   		 <div class="alert alert-danger">
   		 	<%= flash[:danger] %>
   		 </div>
         <% end %>

        <div class="form-group">
        <%= form_for [@book, @book_comment] do |f| %>

      	<%= f.text_area :comment, rows:'5', class:"form-control" %>
        <div class="row">
     	<div class="col-xs-1 col-xs-offset-9">
    	<%= f.submit :"コメントする" %>
        </div>
        </div>
		<% end %>
       </div>
      </div>

  </div>
</div>
